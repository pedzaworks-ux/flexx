<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <meta name="description" content="Flexxmart Admin Dashboard - Manage orders, users, products and analytics" />
  <title>Flexxmart Admin | Dashboard</title>
  
  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  
  <!-- Custom Styles -->
  <style>
    /* Enhanced responsive typography */
    @media (max-width: 640px) {
      .text-responsive {
        font-size: clamp(0.75rem, 3.5vw, 1rem);
      }
      .text-responsive-sm {
        font-size: clamp(0.65rem, 2.8vw, 0.875rem);
      }
      .card-responsive {
        padding: clamp(0.75rem, 4vw, 1.5rem);
      }
    }

    /* Loading animations */
    .loading-skeleton {
      background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
      background-size: 200% 100%;
      animation: loading 1.5s infinite;
    }

    @keyframes loading {
      0% { background-position: 200% 0; }
      100% { background-position: -200% 0; }
    }

    .fade-in {
      animation: fadeIn 0.5s ease-in;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    /* Enhanced glassmorphism effects */
    .glass {
      background: rgba(255, 255, 255, 0.9);
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.2);
    }

    /* Custom scrollbar */
    .custom-scrollbar::-webkit-scrollbar {
      width: 6px;
    }
    
    .custom-scrollbar::-webkit-scrollbar-track {
      background: #f1f1f1;
      border-radius: 3px;
    }
    
    .custom-scrollbar::-webkit-scrollbar-thumb {
      background: #c1c1c1;
      border-radius: 3px;
    }
    
    .custom-scrollbar::-webkit-scrollbar-thumb:hover {
      background: #a8a8a8;
    }

    /* Status indicators */
    .status-indicator {
      position: relative;
      display: inline-flex;
      align-items: center;
    }

    .status-indicator::before {
      content: '';
      width: 8px;
      height: 8px;
      border-radius: 50%;
      margin-right: 8px;
    }

    .status-completed::before {
      background-color: #10b981;
      box-shadow: 0 0 6px rgba(16, 185, 129, 0.6);
    }

    .status-pending::before {
      background-color: #f59e0b;
      box-shadow: 0 0 6px rgba(245, 158, 11, 0.6);
    }

    .status-cancelled::before {
      background-color: #ef4444;
      box-shadow: 0 0 6px rgba(239, 68, 68, 0.6);
    }

    /* Enhanced hover effects */
    .card-hover {
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }

    .card-hover:hover {
      transform: translateY(-2px);
      box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
    }

    /* Dark mode support preparation */
    @media (prefers-color-scheme: dark) {
      .auto-dark {
        background: #1f2937;
        color: #f9fafb;
      }
    }
  </style>
</head>

<body class="min-h-screen bg-gradient-to-br from-slate-50 via-blue-50 to-indigo-100">
  <!-- Loading Overlay -->
  <div id="loadingOverlay" class="fixed inset-0 bg-white bg-opacity-90 flex items-center justify-center z-[100]">
    <div class="text-center">
      <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"></div>
      <p class="text-gray-600">Loading dashboard...</p>
    </div>
  </div>

  <!-- Mobile Header -->
  <header class="lg:hidden fixed top-0 left-0 right-0 glass text-gray-800 flex items-center justify-between px-4 py-3 shadow-lg z-50">
    <div class="flex items-center space-x-2">
      <div class="w-8 h-8 bg-gradient-to-r from-blue-600 to-purple-600 rounded-lg flex items-center justify-center">
        <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
          <path d="M3 4a1 1 0 011-1h12a1 1 0 011 1v2a1 1 0 01-1 1H4a1 1 0 01-1-1V4zM3 10a1 1 0 011-1h6a1 1 0 011 1v6a1 1 0 01-1 1H4a1 1 0 01-1-1v-6zM14 9a1 1 0 00-1 1v6a1 1 0 001 1h2a1 1 0 001-1v-6a1 1 0 00-1-1h-2z" />
        </svg>
      </div>
      <span class="text-lg font-bold bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent">Flexxmart</span>
    </div>

    <button 
      id="logoutBtn" 
      class="bg-red-500 hover:bg-red-600 text-white px-3 py-1.5 rounded-lg text-sm font-semibold transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-red-500 focus:ring-opacity-50"
      aria-label="Logout">
      Logout
    </button>
  </header>

  <!-- Bottom Navigation (Mobile Only) -->
  <nav class="fixed bottom-0 left-0 right-0 glass border-t border-gray-200 flex justify-around items-center py-2 shadow-lg lg:hidden z-50" role="navigation" aria-label="Main navigation">
    <a href="admin_dashboard.html" class="flex flex-col items-center text-xs text-blue-600 font-semibold" aria-current="page">
      <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 mb-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 9l9-7 9 7v11a2 2 0 01-2 2h-4a2 2 0 01-2-2H9a2 2 0 01-2 2H5a2 2 0 01-2-2z" />
      </svg>
      Dashboard
    </a>
    <a href="admin_orders.html" class="flex flex-col items-center text-xs text-gray-600 hover:text-blue-600 transition-colors">
      <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 mb-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2" />
      </svg>
      Orders
    </a>
    <a href="admin_users.html" class="flex flex-col items-center text-xs text-gray-600 hover:text-blue-600 transition-colors">
      <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 mb-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z" />
      </svg>
      Users
    </a>
    <a href="admin_products.html" class="flex flex-col items-center text-xs text-gray-600 hover:text-blue-600 transition-colors">
      <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 mb-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4" />
      </svg>
      Products
    </a>
    <a href="admin_categories.html" class="flex flex-col items-center text-xs text-gray-600 hover:text-blue-600 transition-colors">
      <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 mb-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h7" />
      </svg>
      Categories
    </a>
    <a href="admin_stock.html" class="flex flex-col items-center text-xs text-gray-600 hover:text-blue-600 transition-colors">
      <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 mb-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 7v10c0 2.21 3.582 4 8 4s8-1.79 8-4V7M4 7c0 2.21 3.582 4 8 4s8-1.79 8-4M4 7c0-2.21 3.582-4 8-4s8 1.79 8 4" />
      </svg>
      Stock
    </a>
  </nav>

  <!-- Desktop Layout -->
  <div class="lg:flex min-h-screen">
    <!-- Sidebar -->
    <aside class="w-64 bg-gradient-to-b from-gray-900 to-gray-800 text-white shadow-2xl hidden lg:block">
      <div class="p-6 border-b border-gray-700">
        <div class="flex items-center space-x-3">
          <div class="w-10 h-10 bg-gradient-to-r from-blue-500 to-purple-600 rounded-xl flex items-center justify-center">
            <svg class="w-6 h-6 text-white" fill="currentColor" viewBox="0 0 20 20">
              <path d="M3 4a1 1 0 011-1h12a1 1 0 011 1v2a1 1 0 01-1 1H4a1 1 0 01-1-1V4zM3 10a1 1 0 011-1h6a1 1 0 011 1v6a1 1 0 01-1 1H4a1 1 0 01-1-1v-6zM14 9a1 1 0 00-1 1v6a1 1 0 001 1h2a1 1 0 001-1v-6a1 1 0 00-1-1h-2z" />
            </svg>
          </div>
          <div>
            <div class="font-bold text-xl">Flexxmart</div>
            <div class="text-xs text-gray-400">Admin Panel</div>
          </div>
        </div>
      </div>
      
      <nav class="mt-6 px-3" role="navigation" aria-label="Sidebar navigation">
        <div class="space-y-1">
          <a href="admin_dashboard.html" 
             class="group flex items-center px-3 py-3 text-sm font-medium rounded-xl bg-blue-600 text-white shadow-lg" 
             aria-current="page">
            <svg class="w-5 h-5 mr-3" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 9l9-7 9 7v11a2 2 0 01-2 2h-4a2 2 0 01-2-2H9a2 2 0 01-2 2H5a2 2 0 01-2-2z" />
            </svg>
            Dashboard
          </a>
          <a href="admin_orders.html" class="group flex items-center px-3 py-3 text-sm font-medium text-gray-300 rounded-xl hover:bg-gray-700 hover:text-white transition-all duration-200">
            <svg class="w-5 h-5 mr-3" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2" />
            </svg>
            Orders
          </a>
          <a href="admin_users.html" class="group flex items-center px-3 py-3 text-sm font-medium text-gray-300 rounded-xl hover:bg-gray-700 hover:text-white transition-all duration-200">
            <svg class="w-5 h-5 mr-3" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z" />
            </svg>
            Users
          </a>
          <a href="admin_products.html" class="group flex items-center px-3 py-3 text-sm font-medium text-gray-300 rounded-xl hover:bg-gray-700 hover:text-white transition-all duration-200">
            <svg class="w-5 h-5 mr-3" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4" />
            </svg>
            Products
          </a>
          <a href="admin_categories.html" class="group flex items-center px-3 py-3 text-sm font-medium text-gray-300 rounded-xl hover:bg-gray-700 hover:text-white transition-all duration-200">
            <svg class="w-5 h-5 mr-3" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h7" />
            </svg>
            Categories
          </a>
          <a href="admin_stock.html" class="group flex items-center px-3 py-3 text-sm font-medium text-gray-300 rounded-xl hover:bg-gray-700 hover:text-white transition-all duration-200">
            <svg class="w-5 h-5 mr-3" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 7v10c0 2.21 3.582 4 8 4s8-1.79 8-4V7M4 7c0 2.21 3.582 4 8 4s8-1.79 8-4M4 7c0-2.21 3.582-4 8-4s8 1.79 8 4" />
            </svg>
            Stock
          </a>
        </div>
      </nav>
      
      <div class="absolute bottom-0 w-64 p-4 border-t border-gray-700">
        <button 
          id="desktopLogoutBtn"
          class="w-full bg-gradient-to-r from-red-500 to-red-600 hover:from-red-600 hover:to-red-700 text-white py-2.5 px-4 rounded-xl font-semibold transition-all duration-200 shadow-lg hover:shadow-xl focus:outline-none focus:ring-2 focus:ring-red-500 focus:ring-opacity-50">
          <svg class="w-4 h-4 inline mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1" />
          </svg>
          Logout
        </button>
      </div>
    </aside>

    <!-- Main Content -->
    <div class="flex-1 flex flex-col min-h-screen">
      <!-- Top Header -->
      <header class="hidden lg:flex glass border-b border-gray-200 px-8 py-6 justify-between items-center">
        <div>
          <h1 class="text-3xl font-bold bg-gradient-to-r from-gray-800 to-gray-600 bg-clip-text text-transparent">Dashboard</h1>
          <p class="text-gray-600 text-sm mt-1">Welcome back! Here's what's happening with your store today.</p>
        </div>
        <div class="flex items-center gap-4">
          <div class="hidden md:flex items-center space-x-4">
            <div class="text-right">
              <div class="text-sm font-medium text-gray-800" id="adminName">Admin</div>
              <div class="text-xs text-gray-500" id="lastLogin">Last login: Today</div>
            </div>
            <div class="w-10 h-10 bg-gradient-to-r from-blue-500 to-purple-600 rounded-full flex items-center justify-center">
              <span class="text-white font-semibold text-sm" id="adminInitials">A</span>
            </div>
          </div>
        </div>
      </header>

      <main class="flex-1 p-4 lg:p-8 pb-20 lg:pb-8 pt-20 lg:pt-0 custom-scrollbar overflow-y-auto">
        <!-- Stats Cards -->
        <div class="grid grid-cols-1 sm:grid-cols-2 xl:grid-cols-4 gap-6 mb-8">
          <!-- Total Orders Card -->
          <div class="glass rounded-2xl p-6 card-hover fade-in">
            <div class="flex items-center justify-between">
              <div class="flex-1">
                <p class="text-sm font-medium text-gray-600 mb-1">Total Orders</p>
                <div class="flex items-baseline space-x-2">
                  <p id="totalOrders" class="text-3xl font-bold bg-gradient-to-r from-blue-600 to-blue-800 bg-clip-text text-transparent">
                    <span class="loading-skeleton inline-block w-16 h-8 rounded"></span>
                  </p>
                  <span id="orderChange" class="text-xs font-semibold text-green-600 bg-green-100 px-2 py-1 rounded-full">
                    <span class="loading-skeleton inline-block w-8 h-3 rounded"></span>
                  </span>
                </div>
              </div>
              <div class="bg-gradient-to-r from-blue-500 to-blue-600 p-4 rounded-2xl shadow-lg">
                <svg class="w-8 h-8 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2" />
                </svg>
              </div>
            </div>
            <p class="text-xs text-gray-500 mt-4 flex items-center">
              <svg class="w-3 h-3 mr-1" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M12 7a1 1 0 110-2h5a1 1 0 011 1v5a1 1 0 11-2 0V8.414l-4.293 4.293a1 1 0 01-1.414 0L8 10.414l-4.293 4.293a1 1 0 01-1.414-1.414l5-5a1 1 0 011.414 0L11 10.586 14.586 7H12z" clip-rule="evenodd" />
              </svg>
              from last month
            </p>
          </div>
          
          <!-- Total Revenue Card -->
          <div class="glass rounded-2xl p-6 card-hover fade-in">
            <div class="flex items-center justify-between">
              <div class="flex-1">
                <p class="text-sm font-medium text-gray-600 mb-1">Total Revenue</p>
                <div class="flex items-baseline space-x-2">
                  <p id="totalRevenue" class="text-3xl font-bold bg-gradient-to-r from-green-600 to-emerald-600 bg-clip-text text-transparent">
                    <span class="loading-skeleton inline-block w-20 h-8 rounded"></span>
                  </p>
                  <span id="revenueChange" class="text-xs font-semibold text-green-600 bg-green-100 px-2 py-1 rounded-full">
                    <span class="loading-skeleton inline-block w-8 h-3 rounded"></span>
                  </span>
                </div>
              </div>
              <div class="bg-gradient-to-r from-green-500 to-emerald-500 p-4 rounded-2xl shadow-lg">
                <svg class="w-8 h-8 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                </svg>
              </div>
            </div>
            <p class="text-xs text-gray-500 mt-4 flex items-center">
              <svg class="w-3 h-3 mr-1" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M12 7a1 1 0 110-2h5a1 1 0 011 1v5a1 1 0 11-2 0V8.414l-4.293 4.293a1 1 0 01-1.414 0L8 10.414l-4.293 4.293a1 1 0 01-1.414-1.414l5-5a1 1 0 011.414 0L11 10.586 14.586 7H12z" clip-rule="evenodd" />
              </svg>
              from last month
            </p>
          </div>
          
          <!-- Active Users Card -->
          <div class="glass rounded-2xl p-6 card-hover fade-in">
            <div class="flex items-center justify-between">
              <div class="flex-1">
                <p class="text-sm font-medium text-gray-600 mb-1">Active Users</p>
                <div class="flex items-baseline space-x-2">
                  <p id="totalUsers" class="text-3xl font-bold bg-gradient-to-r from-purple-600 to-pink-600 bg-clip-text text-transparent">
                    <span class="loading-skeleton inline-block w-16 h-8 rounded"></span>
                  </p>
                  <span id="userChange" class="text-xs font-semibold text-green-600 bg-green-100 px-2 py-1 rounded-full">
                    <span class="loading-skeleton inline-block w-8 h-3 rounded"></span>
                  </span>
                </div>
              </div>
              <div class="bg-gradient-to-r from-purple-500 to-pink-500 p-4 rounded-2xl shadow-lg">
                <svg class="w-8 h-8 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z" />
                </svg>
              </div>
            </div>
            <p class="text-xs text-gray-500 mt-4 flex items-center">
              <svg class="w-3 h-3 mr-1" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M12 7a1 1 0 110-2h5a1 1 0 011 1v5a1 1 0 11-2 0V8.414l-4.293 4.293a1 1 0 01-1.414 0L8 10.414l-4.293 4.293a1 1 0 01-1.414-1.414l5-5a1 1 0 011.414 0L11 10.586 14.586 7H12z" clip-rule="evenodd" />
              </svg>
              from last month
            </p>
          </div>
          
          <!-- Products Card -->
          <div class="glass rounded-2xl p-6 card-hover fade-in">
            <div class="flex items-center justify-between">
              <div class="flex-1">
                <p class="text-sm font-medium text-gray-600 mb-1">Products</p>
                <div class="flex items-baseline space-x-2">
                  <p id="totalProducts" class="text-3xl font-bold bg-gradient-to-r from-orange-600 to-red-600 bg-clip-text text-transparent">
                    <span class="loading-skeleton inline-block w-16 h-8 rounded"></span>
                  </p>
                  <span id="productChange" class="text-xs font-semibold text-green-600 bg-green-100 px-2 py-1 rounded-full">
                    <span class="loading-skeleton inline-block w-8 h-3 rounded"></span>
                  </span>
                </div>
              </div>
              <div class="bg-gradient-to-r from-orange-500 to-red-500 p-4 rounded-2xl shadow-lg">
                <svg class="w-8 h-8 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4" />
                </svg>
              </div>
            </div>
            <p class="text-xs text-gray-500 mt-4 flex items-center">
              <svg class="w-3 h-3 mr-1" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M12 7a1 1 0 110-2h5a1 1 0 011 1v5a1 1 0 11-2 0V8.414l-4.293 4.293a1 1 0 01-1.414 0L8 10.414l-4.293 4.293a1 1 0 01-1.414-1.414l5-5a1 1 0 011.414 0L11 10.586 14.586 7H12z" clip-rule="evenodd" />
              </svg>
              from last month
            </p>
          </div>
        </div>

        <!-- Quick Actions -->
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
          <button class="glass rounded-2xl p-6 text-left hover:shadow-lg transition-all duration-200 group" onclick="window.location.href='admin_orders.html'">
            <div class="flex items-center justify-between mb-4">
              <div class="bg-blue-100 p-3 rounded-xl group-hover:bg-blue-200 transition-colors">
                <svg class="w-6 h-6 text-blue-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6" />
                </svg>
              </div>
              <svg class="w-5 h-5 text-gray-400 group-hover:text-gray-600 transition-colors" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
              </svg>
            </div>
            <h3 class="font-semibold text-gray-800 mb-2">Manage Orders</h3>
            <p class="text-sm text-gray-600">View and process customer orders</p>
          </button>

          <button class="glass rounded-2xl p-6 text-left hover:shadow-lg transition-all duration-200 group" onclick="window.location.href='admin_products.html'">
            <div class="flex items-center justify-between mb-4">
              <div class="bg-green-100 p-3 rounded-xl group-hover:bg-green-200 transition-colors">
                <svg class="w-6 h-6 text-green-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4" />
                </svg>
              </div>
              <svg class="w-5 h-5 text-gray-400 group-hover:text-gray-600 transition-colors" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
              </svg>
            </div>
            <h3 class="font-semibold text-gray-800 mb-2">Add Products</h3>
            <p class="text-sm text-gray-600">Create and manage product catalog</p>
          </button>

          <button class="glass rounded-2xl p-6 text-left hover:shadow-lg transition-all duration-200 group" onclick="window.location.href='admin_stock.html'">
            <div class="flex items-center justify-between mb-4">
              <div class="bg-yellow-100 p-3 rounded-xl group-hover:bg-yellow-200 transition-colors">
                <svg class="w-6 h-6 text-yellow-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 7v10c0 2.21 3.582 4 8 4s8-1.79 8-4V7M4 7c0 2.21 3.582 4 8 4s8-1.79 8-4M4 7c0-2.21 3.582-4 8-4s8 1.79 8 4" />
                </svg>
              </div>
              <svg class="w-5 h-5 text-gray-400 group-hover:text-gray-600 transition-colors" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
              </svg>
            </div>
            <h3 class="font-semibold text-gray-800 mb-2">Monitor Stock</h3>
            <p class="text-sm text-gray-600">Check inventory levels and alerts</p>
          </button>
        </div>

        <!-- Recent Orders Section -->
        <div class="glass rounded-2xl shadow-xl overflow-hidden fade-in">
          <div class="bg-gradient-to-r from-gray-50 to-blue-50 p-6 border-b border-gray-200">
            <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4">
              <div>
                <h2 class="text-xl font-bold text-gray-800 mb-1">Recent Orders</h2>
                <p class="text-sm text-gray-600">Latest customer orders and their status</p>
              </div>
              <div class="flex items-center space-x-3">
                <button id="refreshOrders" class="p-2 text-gray-500 hover:text-gray-700 rounded-lg hover:bg-gray-100 transition-colors" title="Refresh orders">
                  <svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
                  </svg>
                </button>
                <a href="admin_orders.html" class="inline-flex items-center px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white text-sm font-semibold rounded-lg transition-colors duration-200">
                  View All Orders
                  <svg class="w-4 h-4 ml-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
                  </svg>
                </a>
              </div>
            </div>
          </div>
          
          <!-- Desktop Table -->
          <div class="hidden lg:block overflow-x-auto">
            <table class="min-w-full text-sm">
              <thead class="bg-gray-50 border-b border-gray-200">
                <tr>
                  <th class="px-6 py-4 text-left font-semibold text-gray-700">Order ID</th>
                  <th class="px-6 py-4 text-left font-semibold text-gray-700">Customer</th>
                  <th class="px-6 py-4 text-left font-semibold text-gray-700">Date & Time</th>
                  <th class="px-6 py-4 text-left font-semibold text-gray-700">Amount</th>
                  <th class="px-6 py-4 text-left font-semibold text-gray-700">Status</th>
                  <th class="px-6 py-4 text-right font-semibold text-gray-700">Action</th>
                </tr>
              </thead>
              <tbody id="recentOrdersTable" class="divide-y divide-gray-100">
                <!-- Loading rows -->
                <tr class="hover:bg-gray-50">
                  <td class="px-6 py-4"><div class="loading-skeleton w-20 h-4 rounded"></div></td>
                  <td class="px-6 py-4"><div class="loading-skeleton w-24 h-4 rounded"></div></td>
                  <td class="px-6 py-4"><div class="loading-skeleton w-20 h-4 rounded"></div></td>
                  <td class="px-6 py-4"><div class="loading-skeleton w-16 h-4 rounded"></div></td>
                  <td class="px-6 py-4"><div class="loading-skeleton w-18 h-6 rounded-full"></div></td>
                  <td class="px-6 py-4 text-right"><div class="loading-skeleton w-12 h-4 rounded"></div></td>
                </tr>
                <tr class="hover:bg-gray-50">
                  <td class="px-6 py-4"><div class="loading-skeleton w-20 h-4 rounded"></div></td>
                  <td class="px-6 py-4"><div class="loading-skeleton w-28 h-4 rounded"></div></td>
                  <td class="px-6 py-4"><div class="loading-skeleton w-20 h-4 rounded"></div></td>
                  <td class="px-6 py-4"><div class="loading-skeleton w-16 h-4 rounded"></div></td>
                  <td class="px-6 py-4"><div class="loading-skeleton w-18 h-6 rounded-full"></div></td>
                  <td class="px-6 py-4 text-right"><div class="loading-skeleton w-12 h-4 rounded"></div></td>
                </tr>
                <tr class="hover:bg-gray-50">
                  <td class="px-6 py-4"><div class="loading-skeleton w-20 h-4 rounded"></div></td>
                  <td class="px-6 py-4"><div class="loading-skeleton w-26 h-4 rounded"></div></td>
                  <td class="px-6 py-4"><div class="loading-skeleton w-20 h-4 rounded"></div></td>
                  <td class="px-6 py-4"><div class="loading-skeleton w-16 h-4 rounded"></div></td>
                  <td class="px-6 py-4"><div class="loading-skeleton w-18 h-6 rounded-full"></div></td>
                  <td class="px-6 py-4 text-right"><div class="loading-skeleton w-12 h-4 rounded"></div></td>
                </tr>
              </tbody>
            </table>
          </div>
          
          <!-- Mobile Card View -->
          <div id="recentOrdersMobile" class="lg:hidden divide-y divide-gray-100">
            <!-- Loading cards -->
            <div class="p-4">
              <div class="flex justify-between items-start mb-3">
                <div class="loading-skeleton w-32 h-5 rounded"></div>
                <div class="loading-skeleton w-16 h-6 rounded-full"></div>
              </div>
              <div class="loading-skeleton w-24 h-4 rounded mb-2"></div>
              <div class="grid grid-cols-2 gap-2">
                <div class="loading-skeleton w-full h-4 rounded"></div>
                <div class="loading-skeleton w-full h-4 rounded"></div>
              </div>
            </div>
            <div class="p-4">
              <div class="flex justify-between items-start mb-3">
                <div class="loading-skeleton w-36 h-5 rounded"></div>
                <div class="loading-skeleton w-20 h-6 rounded-full"></div>
              </div>
              <div class="loading-skeleton w-28 h-4 rounded mb-2"></div>
              <div class="grid grid-cols-2 gap-2">
                <div class="loading-skeleton w-full h-4 rounded"></div>
                <div class="loading-skeleton w-full h-4 rounded"></div>
              </div>
            </div>
          </div>
        </div>

        <!-- Low Stock Alert (if any) -->
        <div id="lowStockAlert" class="hidden mt-6 bg-gradient-to-r from-yellow-50 to-orange-50 border border-yellow-200 rounded-2xl p-6">
          <div class="flex items-start space-x-3">
            <div class="flex-shrink-0">
              <svg class="w-6 h-6 text-yellow-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L4.082 16.5c-.77.833.192 2.5 1.732 2.5z" />
              </svg>
            </div>
            <div class="flex-1">
              <h3 class="font-semibold text-yellow-800 mb-1">Low Stock Alert</h3>
              <p class="text-sm text-yellow-700 mb-3">Some products are running low on stock and need restocking.</p>
              <a href="admin_stock.html" class="inline-flex items-center text-sm font-semibold text-yellow-700 hover:text-yellow-800">
                View Stock Details
                <svg class="w-4 h-4 ml-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
                </svg>
              </a>
            </div>
          </div>
        </div>
      </main>
    </div>
  </div>

  <!-- Error Toast -->
  <div id="errorToast" class="fixed bottom-4 right-4 bg-red-500 text-white px-6 py-3 rounded-lg shadow-lg transform translate-y-full transition-transform duration-300 z-50">
    <div class="flex items-center space-x-2">
      <svg class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
      </svg>
      <span id="errorMessage">An error occurred</span>
    </div>
  </div>

  <!-- Success Toast -->
  <div id="successToast" class="fixed bottom-4 right-4 bg-green-500 text-white px-6 py-3 rounded-lg shadow-lg transform translate-y-full transition-transform duration-300 z-50">
    <div class="flex items-center space-x-2">
      <svg class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
      </svg>
      <span id="successMessage">Success!</span>
    </div>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import {
      getFirestore, collection, getDocs, doc, getDoc,
      query, orderBy, limit, onSnapshot, where
    } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";
    import { 
      getAuth, onAuthStateChanged, signOut 
    } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";

    // Firebase configuration
    const firebaseConfig = {
      apiKey: "AIzaSyBPONiic8kjN_WBB66r6y04zDB6mI1dTYw",
      authDomain: "flexxmart-5127c.firebaseapp.com",
      projectId: "flexxmart-5127c",
      storageBucket: "flexxmart-5127c.appspot.com",
      messagingSenderId: "220683612360",
      appId: "1:220683612360:web:9898850a45983dd31475fd"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const auth = getAuth(app);

    // Utility Functions
    const showToast = (type, message) => {
      const toast = document.getElementById(`${type}Toast`);
      const messageEl = document.getElementById(`${type}Message`);
      messageEl.textContent = message;
      toast.classList.remove('translate-y-full');
      setTimeout(() => {
        toast.classList.add('translate-y-full');
      }, 3000);
    };

    const formatCurrency = (amount) => {
      if (typeof amount === 'string') {
        amount = amount.replace(/[^\d.]/g, '');
      }
      const parsed = parseFloat(amount);
      return isNaN(parsed) ? '$0.00' : `${parsed.toLocaleString('en-US', { minimumFractionDigits: 2 })}`;
    };

    const formatDate = (timestamp) => {
      if (!timestamp) return 'N/A';
      const date = new Date(timestamp);
      return date.toLocaleDateString('en-US', { 
        month: 'short', 
        day: 'numeric', 
        year: 'numeric',
        hour: '2-digit',
        minute: '2-digit'
      });
    };

    const getStatusColor = (status) => {
      const statusLower = (status || 'pending').toLowerCase();
      const statusMap = {
        'completed': 'bg-green-100 text-green-800 status-completed',
        'confirmed': 'bg-blue-100 text-blue-800',
        'delivered': 'bg-green-100 text-green-800 status-completed',
        'pickedup': 'bg-green-100 text-green-800 status-completed',
        'pending': 'bg-yellow-100 text-yellow-800 status-pending',
        'processing': 'bg-blue-100 text-blue-800',
        'cancelled': 'bg-red-100 text-red-800 status-cancelled',
        'refunded': 'bg-gray-100 text-gray-800'
      };
      return statusMap[statusLower] || 'bg-gray-100 text-gray-800';
    };

    // Enhanced Dashboard Statistics
    let unsubscribeStats = [];
    
    const loadDashboardStats = () => {
      try {
        // Orders statistics with real-time updates
        const ordersUnsub = onSnapshot(collection(db, "orders"), (ordersSnapshot) => {
          const totalOrders = ordersSnapshot.size;
          document.getElementById('totalOrders').textContent = totalOrders.toLocaleString();

          let revenue = 0;
          let completedOrders = 0;
          
          ordersSnapshot.forEach(doc => {
            const order = doc.data();
            const status = order.status?.toLowerCase();

            if (["confirmed", "delivered", "pickedup", "completed"].includes(status)) {
              completedOrders++;
              let total = order.total;
              if (typeof total === 'string') total = total.replace(/[^\d.]/g, '');
              const parsed = parseFloat(total);
              if (!isNaN(parsed)) revenue += parsed;
            }
          });

          document.getElementById('totalRevenue').textContent = formatCurrency(revenue);
          
          // Update percentage changes (mock data for now - you can implement real calculation)
          document.getElementById('orderChange').innerHTML = `
            <svg class="w-3 h-3 inline mr-1" fill="currentColor" viewBox="0 0 20 20">
              <path fill-rule="evenodd" d="M12 7a1 1 0 110-2h5a1 1 0 011 1v5a1 1 0 11-2 0V8.414l-4.293 4.293a1 1 0 01-1.414 0L8 10.414l-4.293 4.293a1 1 0 01-1.414-1.414l5-5a1 1 0 011.414 0L11 10.586 14.586 7H12z" clip-rule="evenodd" />
            </svg>
            +12%
          `;
        }, (error) => {
          console.error("Error loading orders stats:", error);
          showToast('error', 'Failed to load order statistics');
        });

        // Users statistics
        const usersUnsub = onSnapshot(collection(db, "users"), (usersSnapshot) => {
          document.getElementById('totalUsers').textContent = usersSnapshot.size.toLocaleString();
          document.getElementById('userChange').innerHTML = `
            <svg class="w-3 h-3 inline mr-1" fill="currentColor" viewBox="0 0 20 20">
              <path fill-rule="evenodd" d="M12 7a1 1 0 110-2h5a1 1 0 011 1v5a1 1 0 11-2 0V8.414l-4.293 4.293a1 1 0 01-1.414 0L8 10.414l-4.293 4.293a1 1 0 01-1.414-1.414l5-5a1 1 0 011.414 0L11 10.586 14.586 7H12z" clip-rule="evenodd" />
            </svg>
            +5%
          `;
        }, (error) => {
          console.error("Error loading users stats:", error);
          showToast('error', 'Failed to load user statistics');
        });

        // Products statistics
        const productsUnsub = onSnapshot(collection(db, "products"), (productsSnapshot) => {
          document.getElementById('totalProducts').textContent = productsSnapshot.size.toLocaleString();
          document.getElementById('productChange').innerHTML = `
            <svg class="w-3 h-3 inline mr-1" fill="currentColor" viewBox="0 0 20 20">
              <path fill-rule="evenodd" d="M12 7a1 1 0 110-2h5a1 1 0 011 1v5a1 1 0 11-2 0V8.414l-4.293 4.293a1 1 0 01-1.414 0L8 10.414l-4.293 4.293a1 1 0 01-1.414-1.414l5-5a1 1 0 011.414 0L11 10.586 14.586 7H12z" clip-rule="evenodd" />
            </svg>
            +3%
          `;

          // Check for low stock items
          let lowStockCount = 0;
          productsSnapshot.forEach(doc => {
            const product = doc.data();
            const stock = parseInt(product.stock) || 0;
            if (stock < 10) lowStockCount++;
          });

          if (lowStockCount > 0) {
            const alertEl = document.getElementById('lowStockAlert');
            alertEl.classList.remove('hidden');
            alertEl.querySelector('p').textContent = `${lowStockCount} products are running low on stock and need restocking.`;
          }
        }, (error) => {
          console.error("Error loading products stats:", error);
          showToast('error', 'Failed to load product statistics');
        });

        // Revenue percentage change calculation
        const revenueUnsub = onSnapshot(collection(db, "orders"), (snapshot) => {
          document.getElementById('revenueChange').innerHTML = `
            <svg class="w-3 h-3 inline mr-1" fill="currentColor" viewBox="0 0 20 20">
              <path fill-rule="evenodd" d="M12 7a1 1 0 110-2h5a1 1 0 011 1v5a1 1 0 11-2 0V8.414l-4.293 4.293a1 1 0 01-1.414 0L8 10.414l-4.293 4.293a1 1 0 01-1.414-1.414l5-5a1 1 0 011.414 0L11 10.586 14.586 7H12z" clip-rule="evenodd" />
            </svg>
            +18%
          `;
        });

        unsubscribeStats = [ordersUnsub, usersUnsub, productsUnsub, revenueUnsub];

      } catch (error) {
        console.error("Error loading dashboard stats:", error);
        showToast('error', 'Failed to load dashboard statistics');
      }
    };

    // Enhanced Recent Orders Loading
    let unsubscribeOrders = null;

    const loadRecentOrders = () => {
      try {
        const q = query(
          collection(db, "orders"), 
          orderBy("timestamp", "desc"), 
          limit(5)
        );

        unsubscribeOrders = onSnapshot(q, async (querySnapshot) => {
          if (querySnapshot.empty) {
            document.getElementById('recentOrdersTable').innerHTML = `
              <tr>
                <td colspan="6" class="px-6 py-8 text-center text-gray-500">
                  <div class="flex flex-col items-center">
                    <svg class="w-12 h-12 text-gray-300 mb-3" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2" />
                    </svg>
                    <p class="font-medium">No recent orders found</p>
                    <p class="text-sm text-gray-400 mt-1">Orders will appear here once customers start placing them</p>
                  </div>
                </td>
              </tr>`;
            
            document.getElementById('recentOrdersMobile').innerHTML = `
              <div class="p-8 text-center text-gray-500">
                <div class="flex flex-col items-center">
                  <svg class="w-12 h-12 text-gray-300 mb-3" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2" />
                  </svg>
                  <p class="font-medium">No recent orders found</p>
                  <p class="text-sm text-gray-400 mt-1">Orders will appear here once customers start placing them</p>
                </div>
              </div>`;
            return;
          }

          let desktopHTML = '';
          let mobileHTML = '';

          for (const docSnap of querySnapshot.docs) {
            const order = docSnap.data();
            const orderId = docSnap.id;
            const date = formatDate(order.timestamp);
            const status = (order.status || "pending").charAt(0).toUpperCase() + (order.status || "pending").slice(1);
            let customerName = "Guest Customer";
            let total = order.total;

            // Format total amount
            if (typeof total === 'string') {
              total = total.replace(/[^\d.]/g, '');
            }
            total = isNaN(parseFloat(total)) ? '0.00' : parseFloat(total).toFixed(2);

            // Fetch customer name if userId exists
            if (order.userId) {
              try {
                const userSnap = await getDoc(doc(db, "users", order.userId));
                if (userSnap.exists()) {
                  const user = userSnap.data();
                  customerName = `${user.firstName || ''} ${user.lastName || ''}`.trim() || user.name || "Customer";
                }
              } catch (err) {
                console.warn("User fetch failed:", err);
              }
            } else if (order.customerName) {
              customerName = order.customerName;
            }

            const statusColorClass = getStatusColor(status);
            const orderIdShort = orderId.substring(0, 8) + '...';

            desktopHTML += `
              <tr class="hover:bg-gray-50 transition-colors duration-150">
                <td class="px-6 py-4">
                  <div class="font-medium text-gray-900">#${orderIdShort}</div>
                </td>
                <td class="px-6 py-4">
                  <div class="flex items-center">
                    <div class="w-8 h-8 bg-gradient-to-r from-blue-500 to-purple-500 rounded-full flex items-center justify-center mr-3">
                      <span class="text-white text-xs font-semibold">${customerName.charAt(0).toUpperCase()}</span>
                    </div>
                    <div>
                      <div class="font-medium text-gray-900">${customerName}</div>
                    </div>
                  </div>
                </td>
                <td class="px-6 py-4 text-gray-600">${date}</td>
                <td class="px-6 py-4">
                  <div class="font-bold text-gray-900">${formatCurrency(total)}</div>
                </td>
                <td class="px-6 py-4">
                  <span class="status-indicator px-3 py-1 rounded-full text-xs font-semibold ${statusColorClass}">${status}</span>
                </td>
                <td class="px-6 py-4 text-right">
                  <a href="admin_orders.html?order=${orderId}" class="inline-flex items-center text-blue-600 hover:text-blue-800 font-medium text-sm transition-colors">
                    View
                    <svg class="w-4 h-4 ml-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
                    </svg>
                  </a>
                </td>
              </tr>`;

            mobileHTML += `
              <div class="p-4 hover:bg-gray-50 transition-colors duration-150">
                <div class="flex justify-between items-start mb-3">
                  <div class="flex items-center space-x-3">
                    <div class="w-10 h-10 bg-gradient-to-r from-blue-500 to-purple-500 rounded-full flex items-center justify-center">
                      <span class="text-white text-sm font-semibold">${customerName.charAt(0).toUpperCase()}</span>
                    </div>
                    <div>
                      <h3 class="font-semibold text-gray-900">Order #${orderIdShort}</h3>
                      <p class="text-sm text-gray-600">${customerName}</p>
                    </div>
                  </div>
                  <span class="status-indicator px-2 py-1 rounded-full text-xs font-semibold ${statusColorClass}">${status}</span>
                </div>
                <div class="grid grid-cols-2 gap-4 text-sm mb-3">
                  <div>
                    <p class="text-xs font-medium text-gray-500 uppercase tracking-wide mb-1">Date & Time</p>
                    <p class="text-gray-900">${date}</p>
                  </div>
                  <div>
                    <p class="text-xs font-medium text-gray-500 uppercase tracking-wide mb-1">Amount</p>
                    <p class="font-bold text-gray-900">${formatCurrency(total)}</p>
                  </div>
                </div>
                <div class="flex justify-end">
                  <a href="admin_orders.html?order=${orderId}" class="inline-flex items-center text-blue-600 hover:text-blue-800 font-medium text-sm transition-colors">
                    View Details
                    <svg class="w-4 h-4 ml-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
                    </svg>
                  </a>
                </div>
              </div>`;
          }

          document.getElementById('recentOrdersTable').innerHTML = desktopHTML;
          document.getElementById('recentOrdersMobile').innerHTML = mobileHTML;
        }, (error) => {
          console.error("Error loading recent orders:", error);
          document.getElementById('recentOrdersTable').innerHTML = `
            <tr>
              <td colspan="6" class="px-6 py-8 text-center">
                <div class="flex flex-col items-center text-red-500">
                  <svg class="w-12 h-12 mb-3" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                  </svg>
                  <p class="font-medium">Failed to load orders</p>
                  <p class="text-sm text-gray-400 mt-1">Please try refreshing the page</p>
                </div>
              </td>
            </tr>`;
          document.getElementById('recentOrdersMobile').innerHTML = `
            <div class="p-8 text-center text-red-500">
              <div class="flex flex-col items-center">
                <svg class="w-12 h-12 mb-3" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                </svg>
                <p class="font-medium">Failed to load orders</p>
                <p class="text-sm text-gray-400 mt-1">Please try refreshing the page</p>
              </div>
            </div>`;
          showToast('error', 'Failed to load recent orders');
        });

      } catch (error) {
        console.error("Error setting up recent orders listener:", error);
        showToast('error', 'Failed to initialize orders tracking');
      }
    };

    // Enhanced Admin Authentication
    const checkAdminAccess = async (user) => {
      try {
        const adminDoc = await getDoc(doc(db, "admins", user.uid));
        if (!adminDoc.exists()) {
          throw new Error("Admin record not found");
        }
        
        const adminData = adminDoc.data();
        if (!adminData.isActive) {
          throw new Error("Admin account is inactive");
        }

        // Update admin info in UI
        if (adminData.name) {
          document.getElementById('adminName').textContent = adminData.name;
          document.getElementById('adminInitials').textContent = adminData.name.charAt(0).toUpperCase();
        }
        
        return true;
      } catch (error) {
        console.error("Admin access check failed:", error);
        return false;
      }
    };

    // Logout functionality
    const handleLogout = async () => {
      try {
        // Cleanup subscriptions
        if (unsubscribeOrders) unsubscribeOrders();
        unsubscribeStats.forEach(unsub => unsub());
        
        await signOut(auth);
        showToast('success', 'Logged out successfully');
        setTimeout(() => {
          window.location.href = "admin_login.html";
        }, 1000);
      } catch (error) {
        console.error("Logout error:", error);
        showToast('error', 'Failed to logout. Please try again.');
      }
    };

    // Refresh orders functionality
    const refreshOrders = () => {
      const refreshBtn = document.getElementById('refreshOrders');
      refreshBtn.classList.add('animate-spin');
      
      // Simulate refresh (the real-time listeners will update automatically)
      setTimeout(() => {
        refreshBtn.classList.remove('animate-spin');
        showToast('success', 'Orders refreshed successfully');
      }, 1000);
    };

    // Initialize Dashboard
    const initializeDashboard = async (user) => {
      try {
        const hasAccess = await checkAdminAccess(user);
        if (!hasAccess) {
          alert("Access denied: You don't have admin privileges or your account is inactive.");
          await signOut(auth);
          window.location.href = "admin_login.html";
          return;
        }

        // Load dashboard data
        loadDashboardStats();
        loadRecentOrders();
        
        // Hide loading overlay
        document.getElementById('loadingOverlay').style.display = 'none';
        
        showToast('success', 'Dashboard loaded successfully');
        
      } catch (error) {
        console.error("Dashboard initialization error:", error);
        document.getElementById('loadingOverlay').innerHTML = `
          <div class="text-center">
            <div class="text-red-500 mb-4">
              <svg class="w-16 h-16 mx-auto mb-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
              </svg>
            </div>
            <p class="text-gray-600 mb-4">Failed to load dashboard</p>
            <button onclick="window.location.reload()" class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors">
              Try Again
            </button>
          </div>`;
        showToast('error', 'Failed to load dashboard');
      }
    };

    // Event Listeners
    document.addEventListener('DOMContentLoaded', () => {
      // Logout button event listeners
      document.getElementById('logoutBtn')?.addEventListener('click', handleLogout);
      document.getElementById('desktopLogoutBtn')?.addEventListener('click', handleLogout);
      
      // Refresh orders button
      document.getElementById('refreshOrders')?.addEventListener('click', refreshOrders);
      
      // Keyboard shortcuts
      document.addEventListener('keydown', (e) => {
        if (e.ctrlKey || e.metaKey) {
          switch(e.key) {
            case 'r':
              e.preventDefault();
              refreshOrders();
              break;
          }
        }
      });
    });

    // Auth State Observer
    onAuthStateChanged(auth, async (user) => {
      if (!user) {
        window.location.href = "admin_login.html";
        return;
      }
      
      await initializeDashboard(user);
    });

    // Cleanup on page unload
    window.addEventListener('beforeunload', () => {
      if (unsubscribeOrders) unsubscribeOrders();
      unsubscribeStats.forEach(unsub => unsub());
    });

    // Performance monitoring
    if ('performance' in window) {
      window.addEventListener('load', () => {
        const perfData = performance.getEntriesByType('navigation')[0];
        console.log(`Dashboard loaded in ${perfData.loadEventEnd - perfData.loadEventStart}ms`);
      });
    }

  </script>
</body>
</html>